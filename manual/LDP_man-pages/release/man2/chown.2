.\" Copyright (c) 1992 Drew Eckhardt (drew@cs.colorado.edu), March 28, 1992
.\" and Copyright (c) 1998 Andries Brouwer (aeb@cwi.nl)
.\" and Copyright (c) 2007, 2008 Michael Kerrisk <mtk.manpages@gmail.com>
.\"
.\" %%%LICENSE_START(VERBATIM)
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one.
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\" %%%LICENSE_END
.\"
.\" Modified by Michael Haardt <michael@moria.de>
.\" Modified 1993-07-21 by Rik Faith <faith@cs.unc.edu>
.\" Modified 1996-07-09 by Andries Brouwer <aeb@cwi.nl>
.\" Modified 1996-11-06 by Eric S. Raymond <esr@thyrsus.com>
.\" Modified 1997-05-18 by Michael Haardt <michael@cantor.informatik.rwth-aachen.de>
.\" Modified 2004-06-23 by Michael Kerrisk <mtk.manpages@gmail.com>
.\" 2007-07-08, mtk, added an example program; updated SYNOPSIS
.\" 2008-05-08, mtk, Describe rules governing ownership of new files
.\"     (bsdgroups versus sysvgroups, and the effect of the parent
.\"     directory's set-group-ID permission bit).
.\"
.\"*******************************************************************
.\"
.\" This file was generated with po4a. Translate the source file.
.\"
.\"*******************************************************************
.\"
.\" Japanese Version Copyright (c) 1996 Yosiaki Yanagihara
.\"         all rights reserved.
.\" Translated 1996-06-24, Yosiaki Yanagihara <yosiaki@bsd2.kbnes.nec.co.jp>
.\" Modified 1998-05-11, HANATAKA Shinya <hanataka@abyss.rim.or.jp>
.\" Modified 2004-02-29, Yuichi SATO <ysato444@yahoo.co.jp>
.\" Updated & Modified Wed Dec 29 06:48:16 JST 2004 by Yuichi SATO
.\" Updated 2007-09-04, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>, LDP v2.64
.\" Updated 2008-08-09, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>, LDP v3.05
.\" Updated 2012-04-30, Akihiro MOTOKI <amotoki@gmail.com>
.\"
.TH CHOWN 2 2010\-11\-22 Linux "Linux Programmer's Manual"
.SH 名前
chown, fchown, lchown \- ファイルの所有者を変更する
.SH 書式
\fB#include <unistd.h>\fP
.sp
\fBint chown(const char *\fP\fIpath\fP\fB, uid_t \fP\fIowner\fP\fB, gid_t \fP\fIgroup\fP\fB);\fP
.br
\fBint fchown(int \fP\fIfd\fP\fB, uid_t \fP\fIowner\fP\fB, gid_t \fP\fIgroup\fP\fB);\fP
.br
\fBint lchown(const char *\fP\fIpath\fP\fB, uid_t \fP\fIowner\fP\fB, gid_t \fP\fIgroup\fP\fB);\fP
.sp
.in -4n
glibc 向けの機能検査マクロの要件 (\fBfeature_test_macros\fP(7)  参照):
.in
.sp
\fBfchown\fP(), \fBlchown\fP():
.PD 0
.ad l
.RS 4
_BSD_SOURCE || _XOPEN_SOURCE\ >=\ 500 || _XOPEN_SOURCE\ &&\ _XOPEN_SOURCE_EXTENDED
.br
|| /* glibc 2.12 以降: */ _POSIX_C_SOURCE\ >=\ 200809L
.RE
.ad
.PD
.SH 説明
これらのシステムコールは、いずれもファイルの所有者 (owner) とグループを変更する。システムコール間の違いは、ファイルの指定の仕方だけである。
.IP * 2
\fBchown\fP()  は \fIpath\fP で指定されたファイルの所有権を変更する。 \fIpath\fP
がシンボリック・リンクの場合は、リンクの展開が行われる。
.IP *
\fBfchown\fP()  はオープンされたファイルディスクリプタ \fIfd\fP により参照されるファイルの所有権を変更する。
.IP *
\fBlchown\fP()  は \fBchown\fP()  と同じだが、シンボリック・リンクを展開しない点が異なる。
.PP
特権を持つプロセス (Linux では \fBCAP_CHOWN\fP ケーパビリティ (capability) を持つプロセス) だけが
ファイルの所有者を変更できる。 ファイルの所有者は、その所有者が属しているグループのいずれかに ファイルのグループを変更することができる。 特権
(Linux では \fBCAP_CHOWN\fP)  を持つプロセスは、任意のグループに変更できる。

\fIowner\fP または \fIgroup\fP に \-1 が指定された場合、それらの ID は変更されない。

.\" In Linux 2.0 kernels, superuser was like everyone else
.\" In 2.2, up to 2.2.12, these bits were not cleared for superuser.
.\" Since 2.2.13, superuser is once more like everyone else.
非特権ユーザーにより実行ファイルの所有者またはグループが 変更された場合は \fBS_ISUID\fP と \fBISGID\fP モードビットはクリアされる。
POSIX はこの動作やルートが \fBchown\fP()  を行なった場合については特に指定されていない。 Linux
における動作はカーネルのバージョンに依存する。 非グループ実行ファイル (\fBS_IXGRP\fP ビットが設定されていないファイル) の場合には
\fBS_ISGID\fP ビットは強制ロック (mandatory locking) を意味している。 そしてそれは \fBchown\fP()
ではクリアできない。
.SH 返り値
成功した場合は 0 が返される。エラーの場合は \-1 が返され、 \fIerrno\fP が適切に設定される。
.SH エラー
Depending on the filesystem, other errors can be returned.  The more general
errors for \fBchown\fP()  are listed below.
.TP 
\fBEACCES\fP
パス名の構成要素に検索許可がない (\fBpath_resolution\fP(7)  も見よ)。
.TP 
\fBEFAULT\fP
\fIpath\fP がアクセスできるアドレス空間外を指している。
.TP 
\fBELOOP\fP
\fIpath\fP を解決する際に遭遇したシンボリック・リンクが多過ぎる。
.TP 
\fBENAMETOOLONG\fP
\fIpath\fP が長過ぎる。
.TP 
\fBENOENT\fP
ファイルが存在しない。
.TP 
\fBENOMEM\fP
カーネルに十分なメモリがない。
.TP 
\fBENOTDIR\fP
パス名の構成要素がディレクトリではない。
.TP 
\fBEPERM\fP
呼び出したプロセスに所有者またはグループ (もしくはその両方) を変更するために 要求される許可 (上記を参照) がない。
.TP 
\fBEROFS\fP
The named file resides on a read\-only filesystem.
.PP
\fBfchown\fP()  で一般的なエラーを以下に挙げる:
.TP 
\fBEBADF\fP
ディスクリプターが有効でない。
.TP 
\fBEIO\fP
i ノード (inode) を変更する際に低レベル I/O エラーが発生した。
.TP 
\fBENOENT\fP
上記を参照。
.TP 
\fBEPERM\fP
上記を参照。
.TP 
\fBEROFS\fP
上記を参照。
.SH 準拠
4.4BSD, SVr4, POSIX.1\-2001.

.\" chown():
.\" SVr4 documents EINVAL, EINTR, ENOLINK and EMULTIHOP returns, but no
.\" ENOMEM.  POSIX.1 does not document ENOMEM or ELOOP error conditions.
.\" fchown():
.\" SVr4 documents additional EINVAL, EIO, EINTR, and ENOLINK
.\" error conditions.
4.4BSD 版ではスーパー・ユーザーのみが使用できる (つまり、普通のユーザーはファイルを手放すことはできない)。
.SH 注意
元々の Linux の \fBchown\fP(), \fBfchown\fP(), \fBlchown\fP() システムコールは、
16 ビットのユーザ ID とグループ ID だけに対応していた。
その後、 32 ビットの ID に対応した \fBchown32\fP(), \fBfchown32\fP(), \fBlchown32\fP()
が Linux 2.4 で追加された。
\fBchown\fP(), \fBfchown\fP(), and \fBlchown\fP() の glibc のラッパー関数は、
カーネルのバージョンによる違いを吸収している。

When a new file is created (by, for example, \fBopen\fP(2)  or \fBmkdir\fP(2)),
its owner is made the same as the filesystem user ID of the creating
process.  The group of the file depends on a range of factors, including the
type of filesystem, the options used to mount the filesystem, and whether or
not the set\-group\-ID permission bit is enabled on the parent directory.  If
the filesystem supports the \fI\-o\ grpid\fP (or, synonymously \fI\-o\ bsdgroups\fP)
and \fI\-o\ nogrpid\fP (or, synonymously \fI\-o\ sysvgroups\fP)  \fBmount\fP(8)
options, then the rules are as follows:
.IP * 2
If the filesystem is mounted with \fI\-o\ grpid\fP, then the group of a new file
is made the same as that of the parent directory.
.IP *
If the filesystem is mounted with \fI\-o\ nogrpid\fP and the set\-group\-ID bit is
disabled on the parent directory, then the group of a new file is made the
same as the process's filesystem GID.
.IP *
If the filesystem is mounted with \fI\-o\ nogrpid\fP and the set\-group\-ID bit is
enabled on the parent directory, then the group of a new file is made the
same as that of the parent directory.
.PP
As at Linux 2.6.25, the \fI\-o\ grpid\fP and \fI\-o\ nogrpid\fP mount options are
supported by ext2, ext3, ext4, and XFS.  Filesystems that don't support
these mount options follow the \fI\-o\ nogrpid\fP rules.
.PP
The \fBchown\fP()  semantics are deliberately violated on NFS filesystems which
have UID mapping enabled.  Additionally, the semantics of all system calls
which access the file contents are violated, because \fBchown\fP()  may cause
immediate access revocation on already open files.  Client side caching may
lead to a delay between the time where ownership have been changed to allow
access for a user and the time where the file can actually be accessed by
the user on other clients.

Linux の 2.1.81 より前のバージョン (特に 2.1.46 以前) では、 \fBchown\fP()  はシンボリック・リンクを追跡しない。
Linux 2.1.81 以降では \fBchown\fP()  はシンボリック・リンクを追跡し、新たなシステム・コール \fBlchown\fP()
はシンボリック・リンクを追跡しない。 Linux 2.1.86 以降ではこの新しいコール (古い \fBchown\fP()  と全く同じ動作を行なう)
は同じシステムコール番号を持ち \fBchown\fP()  は新しく導入された番号を持つ。
.SH 例
.PP
以下のプログラムは、 二つ目のコマンドライン引き数で指定された名前のファイルの所有者を、 一つ目のコマンドライン引き数で指定された値に変更する。
新しい所有者は、数字のユーザ ID かユーザ名のいずれかで指定できる (ユーザ名で指定した場合には、 \fBgetpwnam\fP(3)
を使ってシステムのパスワードファイルの検索が行われ、 ユーザ ID への変換が行われる)。
.nf

#include <pwd.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int
main(int argc, char *argv[])
{
    uid_t uid;
    struct passwd *pwd;
    char *endptr;

    if (argc != 3 || argv[1][0] == \(aq\e0\(aq) {
        fprintf(stderr, "%s <owner> <file>\en", argv[0]);
        exit(EXIT_FAILURE);
    }

    uid = strtol(argv[1], &endptr, 10);  /* Allow a numeric string */

    if (*endptr != \(aq\e0\(aq) {         /* Was not pure numeric string */
        pwd = getpwnam(argv[1]);   /* Try getting UID for username */
        if (pwd == NULL) {
            perror("getpwnam");
            exit(EXIT_FAILURE);
        }

        uid = pwd\->pw_uid;
    }

    if (chown(argv[2], uid, \-1) == \-1) {
        perror("chown");
        exit(EXIT_FAILURE);
    }

    exit(EXIT_SUCCESS);
}
.fi
.SH 関連項目
\fBchmod\fP(2), \fBfchownat\fP(2), \fBflock\fP(2), \fBpath_resolution\fP(7),
\fBsymlink\fP(7)
.SH この文書について
この man ページは Linux \fIman\-pages\fP プロジェクトのリリース 3.54 の一部
である。プロジェクトの説明とバグ報告に関する情報は
http://www.kernel.org/doc/man\-pages/ に書かれている。
